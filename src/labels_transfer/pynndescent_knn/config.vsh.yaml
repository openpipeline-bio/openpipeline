functionality:
  name: pynndescent_knn
  namespace: "labels_transfer"
  description: |
    This component generates a neighborhood graph based using the PyNNDescentTransformer, followed by classification using a k-nearest neighborhood vote.
  authors:
    - __merge__: /src/authors/dorien_roosen.yaml
      roles: [ maintainer, author ]
  argument_groups:
    - name: Input files
      arguments:
        - name: "--input"
          type: file
          direction: input
          required: true
          example: input.h5mu
          description: "The query data to transfer the labels to. Should be a .h5mu file."
        - name: "--modality"
          type: string
          default: "rna"
          required: false
          description: Which modality to use.
        - name: "--input_obsm_features"
          type: string
          required: true
          description: |
            The `.obsm` key of the embedding to use for the classifier's inference.
            Make sure that embedding was obtained in the same way as the reference embedding (e.g. by the same model, preprocessing and/or integration).
          example: X_scvi

    - name: Reference dataset arguments
      arguments:
        - name: "--reference"
          type: file
          required: true
          description: "Should be an h5mu file."
          example: reference.h5mu
        - name: "--reference_obsm_features"
          type: string
          required: true
          description: |
            The `.obsm` key of the embedding to use for the classifier's training.
            Make sure that embedding was obtained in the same way as the query embedding (e.g. by the same model or preprocessing).
          example: X_scvi
        - name: "--reference_obs_targets"
          type: string
          example: [ ann_level_1, ann_level_2, ann_level_3, ann_level_4, ann_level_5, ann_finest_level ]
          required: true
          multiple: true
          description: The `.obs` key(s) of the target labels to tranfer.
  resources:
    - type: python_script
      path: script.py

platforms:
  - type: docker
    image: python:3.12
    setup:
      - type: apt
        packages: 
          - procps
          - pkg-config
          - libhdf5-dev
      - type: python
        __merge__: /src/base/requirements/anndata_mudata.yaml
  - type: native
  - type: nextflow
    directives:
      label: [singlecpu, lowmem]