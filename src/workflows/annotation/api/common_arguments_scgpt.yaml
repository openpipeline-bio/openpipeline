argument_groups:
    - name: Query input
      arguments:
        - name: "--id"
          required: true
          type: string
          description: ID of the sample.
          example: foo
        - name: "--input"
          required: true
          type: file
          description: Input dataset consisting of the (unlabeled) query observations. The dataset is expected to be pre-processed.
          example: input.h5mu
          info:
            label: "Query"
            file_format:
              type: h5mu
              mod:
                rna:
                  description: "Modality in AnnData format containing RNA data."
                  required: true
                  slots:
                    X:
                      type: string
                      name: features
                      required: false
                      description: |
                        The expression data to be subset for highly variable genes and binned prior to integration. 
                        Can be overwitten by --input_layer.
                    var:
                      - type: string
                        name: features
                        example: genes
                        required: false
                        description: |
                          The var column containing the gene names.
                    obs:
                      - type: string
                        name: features
                        example: batch_label
                        required: false
                        description: |
                          The obs column containing the batch labels.
        - name: "--modality"
          description: Which modality to process. Should match the modality of the --reference dataset.
          type: string
          default: "rna"
          required: false
        - name: "--input_layer"
          type: string
          required: False
          description: |
            Mudata layer (key from layers) to use as input data for scGPT-specific pre-processing (hvg subsetting and binning); if not specified, X is used.
        - name: "--var_gene_names"
          type: string
          required: false
          description: |
            The name of the adata var column containing gene names; when no gene_name_layer is provided, the var index will be used.
        - name: "--obs_batch_label"
          type: string
          description: |
            The name of the adata obs column containing the batch labels.

    - name: "Model input"
      arguments:
        - name: "--model"
          type: file
          required: true
          example: best_model.pt
          description: |
            The model file containing checkpoints and cell type label mapper.
        - name: "--model_config"
          type: file
          required: true
          example: args.json
          description: |
            The model configuration file. 
        - name: "--model_vocab"
          type: file
          required: true
          example: vocab.json
          description: |
            Model vocabulary file directory.
        - name: "--finetuned_checkpoints_key"
          type: string
          default: model_state_dict
          description: |
            Key in the model  file containing the pretrained checkpoints.

    - name: "scGPT preprocessing arguments"
      arguments:
        - name: "--pad_token"
          type: string
          default: "<pad>"
          required: false
          description: |
            Token used for padding.
        - name: "--pad_value"
          type: integer
          default: -2
          required: false
          description: |
            The value of the padding token.
        - name: "--n_hvg"
          type: integer
          default: 1200
          description: |
            Number of highly variable genes to subset for.
        - name: "--max_seq_len"
          type: integer
          required: false
          description: |
            The maximum sequence length of the tokenized data.
        - name: "--n_input_bins"
          type: integer
          default: 51
          required: False
          min: 1
          description: |
            The number of bins to discretize the data into; When no value is provided, data won't be binned.
        - name: "--seed"
          type: integer
          required: false
          description: |
            Seed for random number generation used for binning. If not set, no seed is used.
  
    - name: "Outputs"
      arguments:
        - name: "--output"
          type: file
          required: true
          direction: output
          description: The query data in .h5mu format with predicted labels predicted from the classifier trained on the reference.
          example: output.h5mu
          info:
            label: "Output data"
            file_format:
              type: h5mu
              mod:
                rna:
                  description: "Modality in AnnData format containing RNA data."
                  required: true
                  obs:
                    - type: "string"
                      name: "predictions"
                      description: "The predicted labels. Override using the `--output_obs_predictions` argument."
                      required: true
                    - type: "double"
                      name: "probability"
                      description: "The probability of the predicted labels. Override using the `--output_obs_probability` argument."
                      required: false
                  obsm:
                    - type: "double"
                      name: "X_scGPT"
                      description: 
                        The embedding used for the cell type annotation. Could have any name,
                        specified by `obsm_embedding` argument."
                      required: false

        - name: "--output_obs_predictions"
          type: string
          required: false
          multiple: true
          description: |
            In which `.obs` slot to store the predicted information.
            If empty, will default to the `reference_obs_targets` combined with the `"_pred"` suffix.
        - name: "--output_obs_probability"
          type: string
          required: false
          multiple: true
          description: |
            In which `.obs` slots to store the probability of the predictions.
            If provided, must have the same length as `--reference_obs_targets`.
            If empty, will default to the `reference_obs_targets` combined with the `"_probability"` suffix.
        - name: "--output_compression"
          type: string
          description: |
            The compression format to be used on the output h5mu object.
          choices: ["gzip", "lzf"]
          required: false
          example: "gzip"