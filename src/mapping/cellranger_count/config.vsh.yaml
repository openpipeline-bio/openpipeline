functionality:
  name: cellranger_count
  namespace: mapping
  description: Align fastq files using Cell Ranger count.
  authors:
    - name: Angela Pisco
      roles: [ author ]
      props: { github: aopisco, orcid: "0000-0003-0142-2355" }
    - name: Samuel D'Souza
      roles: [ author ]
      props: { github: srdsam }
    - name: Robrecht Cannoodt
      email: rcannood@gmail.com
      roles: [ author, maintainer ]
      props: { github: rcannood, orcid: "0000-0003-3641-729X" }
  arguments:
    # inputs
    - type: file
      name: --input
      required: true
      description: The folder with fastq.gz files to align.
    - type: file
      name: --reference
      required: true
      description: The path to reference tar.gz file.
    
    # outputs
    - type: file
      name: --output
      direction: output
      description: The folder to store the alignment results.
      example: "/path/to/output"
      default: counts
      required: true

    # arguments
    - type: integer
      name: --expect_cells
      default: 3000
      description: "Expected number of recovered cells, used as input to cell calling algorithm."

    - type: string
      name: --chemistry
      default: auto
      description: |
        Assay configuration.
        - auto: autodetect mode
        - threeprime: Single Cell 3'
        - fiveprime: Single Cell 5'
        - SC3Pv1: Single Cell 3' v1
        - SC3Pv2: Single Cell 3' v2
        - SC3Pv3: Single Cell 3' v3
        - SC3Pv3LT: Single Cell 3' v3 LT
        - SC3Pv3HT: Single Cell 3' v3 HT
        - SC5P-PE: Single Cell 5' paired-end
        - SC5P-R2: Single Cell 5' R2-only
        - SC-FB: Single Cell Antibody-only 3' v2 or 5'
        See https://kb.10xgenomics.com/hc/en-us/articles/115003764132-How-does-Cell-Ranger-auto-detect-chemistry- for more information.
      choices: [ auto, threeprime, fiveprime, SC3Pv1, SC3Pv2, SC3Pv3, SC3Pv3LT, SC3Pv3HT, SC5P-PE, SC5P-R2, SC-FB ] 

    - type: boolean
      name: "--secondary_analysis"
      default: false
      description: Whether or not to run the secondary analysis e.g. clustering.

    # runtime args
    - type: integer
      name: --cores
      description:  Set max cores the pipeline may request at one time.
      example: 2
    - type: integer
      name: --memory
      description: Set max GB the pipeline may request at one time.
      example: 10
  resources:
    - type: bash_script
      path: script.sh
  tests:
    - type: python_script
      path: test.py
    - path: ../../../resources_test/cellranger_tiny_fastq
platforms:
  - type: docker
    image: ghcr.io/data-intuitive/cellranger:6.1
    setup:
      - type: docker
        run: apt update && apt upgrade -y
  - type: nextflow
    variant: vdsl3