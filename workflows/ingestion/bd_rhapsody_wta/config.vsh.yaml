functionality:
  name: "bd_rhapsody_wta"
  namespace: "ingestion"
  description: "A pipeline for processing BD Rhapsody WTA data."
  authors:
    - name: Robrecht Cannoodt
      email: rcannood@gmail.com
      roles: [ author, maintainer ]
      props: { github: rcannood, orcid: "0000-0003-3641-729X" }
  inputs:
    - name: "--id"
      required: true
      type: string
      description: ID of the sample.
      example: foo
    - name: "--input"
      alternatives: [-i]
      description: Path to your read files in the FASTQ.GZ format. You may specify as many R1/R2 read pairs as you want.
      required: true
      multiple: true
      multiple_sep: ';'
      example: input.fastq.gz
    - name: "--reference_genome"
      alternatives: [-r]
      required: true
      description: "Path to STAR index as a tar.gz file."
      example: "reference_genome.tar.gz"
    - name: "--transcriptome_annotation"
      alternatives: [-t]
      description: Path to GTF annotation file.
      required: true
      example: "transcriptome.gtf"
    - name: "--abseq_reference"
      alternatives: [-a]
      description: Path to the AbSeq reference file in FASTA format. Only needed if BD AbSeq Ab-Oligos are used.
      multiple: true
      multiple_sep: ';'
    - name: "--supplemental_reference"
      alternatives: [-s]
      description: Path to the supplemental reference file in FASTA format. Only needed if there are additional transgene sequences used in the experiment.
      multiple: true
      multiple_sep: ';'

  arguments:
    # lane splitter settings
    - name: "--r1r2_regex"
      type: string
      description: A regex to detect the R1/R2 labels. This is used to group the samples per lane instead of per sample.
      default: "[^A-Za-z0-9]R[12][^A-Za-z0-9]"

    # putative cell calling settings
    - name: "--putative_cell_call"
      type: string
      description: "Specify the dataset to be used for putative cell calling. For putative cell calling using an AbSeq dataset, please provide an AbSeq_Reference fasta file above."
      choices: [mRNA, AbSeq_Experimental]
      example: mRNA
    - name: "--exact_cell_count"
      type: integer
      description: "Exact cell count - Set a specific number (>=1) of cells as putative, based on those with the highest error-corrected read count"
      example: 10000
    - name: "--disable_putative_calling"
      type: boolean_true
      description: "Disable Refined Putative Cell Calling - Determine putative cells using only the basic algorithm (minimum second derivative along the cumulative reads curve). The refined algorithm attempts to remove false positives and recover false negatives, but may not be ideal for certain complex mixtures of cell types. Does not apply if Exact Cell Count is set."
    
    # subsample settings
    - name: "--subsample"
      type: double
      description: A number >1 or fraction (0 < n < 1) to indicate the number or percentage of reads to subsample.
      example: 0.01
    - name: "--subsample_seed"
      type: integer
      description: A seed for replicating a previous subsampled run.
      example: 3445
    
    # multiplex settings
    - name: "--sample_tags_version"
      type: string
      description: "Specify if multiplexed run."
      choices: [human, hs, mouse, mm]
      example: human

    - name: "--tag_names"
      type: string
      description: |
        Tag_Names (optional) - Specify the tag number followed by '-' and the desired sample name to appear in Sample_Tag_Metrics.csv.
        Do not use the special characters: &, (), [], {},  <>, ?, |
      multiple: true
      example: [4-mySample, 9-myOtherSample, 6-alsoThisSample]
    
    # VDJ settings
    - name: "--vdj_version"
      type: string
      description: "Specify if VDJ run."
      choices: [human, mouse, humanBCR, humanBCR, humanTCR, mouseBCR]
      example: human

    # cwl-runner settings
    - name: "--parallel"
      type: boolean
      description: "Run jobs in parallel."
      default: true
    - name: "--timestamps"
      type: boolean_true
      description: "Add timestamps to the errors, warnings, and notifications."
    - name: "--override_min_ram"
      type: integer
      description: "Override the minimum RAM requirements specified in the CWL (in GB)."
      example: "2"
    - name: "--override_min_cores"
      type: integer
      description: "Override the minimum cores requirements specified in the CWL."
      example: "2"
    - name: "--dryrun"
      type: boolean_true
      description: "If true, the output directory will only contain the CWL input files, but the pipeline itself will not be executed."

    # additional settings
    - name: "--sample_prefix"
      type: string
      description: "Specify a run name to use as the output file base name. Use only letters, numbers, or hyphens. Do not use special characters or spaces."
      default: sample
    - name: "--process_per_lane"
      type: boolean_true
      description: If true, this pipeline will process the samples by lane and then aggregate (Experimental).
  argument_groups:
    - name: Inputs
      arguments: [ id, input, reference_genome, transcriptome_annotation, abseq_reference, supplemental_reference ]
    - name: "Lane splitter arguments"
      description: To reduce the memory resource requirements, samples are mapped per lane instead of per sample. To this end, we need to correctly identify the R1/R2 tags to be able to group the reads correctly.
      arguments: [ r1r2_regex ]
    - name: "Putative cell calling arguments"
      arguments: [ putative_cell_call, exact_cell_count, disable_putative_calling ]
    - name: "Subsample arguments"
      arguments: [ subsample, subsample_seed ]
    - name: "Multiplex arguments"
      arguments: [ sample_tags_version, tag_names ]
    - name: "VDJ arguments"
      arguments: [ vdj_version ]
    - name: "Additional settings"
      arguments: [ sample_prefix ]
    - name: "CWL-runner arguments"
      arguments: [ parallel, timestamps, override_min_ram, override_min_cores, dryrun ]
  resources:
    - type: nextflow_script
      path: main.nf
  test_resources:
    - type: nextflow_script
      path: main.nf
      entrypoint: test_wf